<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cars - Kenya Car Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }
    .car-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .car-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    .special-price {
      color: #dc2626;
      font-weight: bold;
    }
    .fresh-import {
      background: linear-gradient(45deg, #10b981, #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: bold;
    }
    #loadingSpinner {
      display: flex;
      justify-content: center;
      padding: 2rem;
    }
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #3b82f6;
      animation: spin 1s ease infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Image carousel styles */
    .carousel-container {
      position: relative;
      height: 192px; /* Adjust height as needed */
      overflow: hidden;
    }
    .carousel-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.5s ease;
      object-fit: cover;
    }
    .carousel-image.active {
      opacity: 1;
    }
    .carousel-dots {
      position: absolute;
      bottom: 10px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 6px;
    }
    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      border: 1px solid rgba(0, 0, 0, 0.2);
    }
    .carousel-dot.active {
      background-color: white;
    }
    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 30px;
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 1;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 14px;
      color: #444;
    }
    .carousel-container:hover .carousel-arrow {
      opacity: 1;
    }
    .carousel-prev {
      left: 10px;
    }
    .carousel-next {
      right: 10px;
    }
  </style>
</head>
<!-- Rest of your HTML remains unchanged -->

<!-- Replace the car rendering part in your script with this: -->
<script>
  document.addEventListener('DOMContentLoaded', async function() {
    const carListingsContainer = document.getElementById('carListings');

    try {
      // Show loading spinner
      document.getElementById('loadingSpinner').style.display = 'flex';
      
      // Your existing code to fetch cars...
      
      // Function to render all cars
      function renderCars(cars) {
        // Hide loading spinner
        document.getElementById('loadingSpinner').style.display = 'none';
        
        // Check if there are no cars
        if (!cars || cars.length === 0) {
          carListingsContainer.innerHTML = `
            <div class="col-span-3 text-center text-gray-500 py-8">
              No cars available at this time. Please check back later.
            </div>
          `;
          return;
        }
        
        carListingsContainer.innerHTML = '';
        
        // Loop through cars and create HTML for each
        cars.forEach(car => {
          // Get all images from comma-separated list
          const imagesList = car.images ? car.images.split(',') : ['https://images.unsplash.com/photo-1544636331-e26879cd4d9b'];
          
          // Create card element
          const carCard = document.createElement('div');
          carCard.className = 'car-card bg-white rounded-lg shadow-lg overflow-hidden';
          
          // Add featured styling if car is featured
          if (car.isFeatured) {
            carCard.classList.add('border-2', 'border-yellow-200');
            const featuredBanner = document.createElement('div');
            featuredBanner.className = 'bg-yellow-100 px-4 py-2';
            featuredBanner.innerHTML = '<span class="text-yellow-800 font-bold text-xs">FEATURED</span>';
            carCard.appendChild(featuredBanner);
          }
          
          // Create carousel container
          const carouselContainer = document.createElement('div');
          carouselContainer.className = 'carousel-container';
          carouselContainer.dataset.carId = car.id;
          
          // Create images
          imagesList.forEach((imgSrc, index) => {
            const image = document.createElement('img');
            image.src = imgSrc;
            image.alt = `${car.make} ${car.model} - Image ${index + 1}`;
            image.className = `carousel-image ${index === 0 ? 'active' : ''}`;
            image.dataset.index = index;
            carouselContainer.appendChild(image);
          });
          
          // Add navigation elements if there are multiple images
          if (imagesList.length > 1) {
            // Add navigation dots
            const dotsContainer = document.createElement('div');
            dotsContainer.className = 'carousel-dots';
            
            imagesList.forEach((_, index) => {
              const dot = document.createElement('div');
              dot.className = `carousel-dot ${index === 0 ? 'active' : ''}`;
              dot.dataset.index = index;
              dot.dataset.carId = car.id;
              dot.addEventListener('click', function() {
                changeCarouselImage(car.id, parseInt(this.dataset.index));
              });
              dotsContainer.appendChild(dot);
            });
            
            // Add navigation arrows
            const prevArrow = document.createElement('div');
            prevArrow.className = 'carousel-arrow carousel-prev';
            prevArrow.innerHTML = '&#10094;';
            prevArrow.dataset.carId = car.id;
            prevArrow.addEventListener('click', function() {
              navigateCarousel(car.id, -1, imagesList.length);
            });
            
            const nextArrow = document.createElement('div');
            nextArrow.className = 'carousel-arrow carousel-next';
            nextArrow.innerHTML = '&#10095;';
            nextArrow.dataset.carId = car.id;
            nextArrow.addEventListener('click', function() {
              navigateCarousel(car.id, 1, imagesList.length);
            });
            
            carouselContainer.appendChild(dotsContainer);
            carouselContainer.appendChild(prevArrow);
            carouselContainer.appendChild(nextArrow);
          }
          
          carCard.appendChild(carouselContainer);
          
          // Add car details
          const detailsDiv = document.createElement('div');
          detailsDiv.className = 'p-6';
          detailsDiv.innerHTML = `
            <h3 class="text-xl font-bold font-poppins mb-2">${car.make} ${car.model}</h3>
            <p class="text-gray-600 mb-4">${car.colour || ''} ${car.features ? '• ' + car.features.split(',').slice(0, 2).join(' • ') : ''}</p>
            <div class="grid grid-cols-2 gap-2 text-sm text-gray-700">
              <p><strong>Year:</strong> ${car.year || 'N/A'}</p>
              <p><strong>Mileage:</strong> ${car.mileage ? car.mileage + ' km' : 'N/A'}</p>
              <p><strong>Engine:</strong> ${car.engine || 'N/A'}</p>
              <p><strong>Fuel:</strong> ${car.fuel || 'N/A'}</p>
              <p><strong>Transmission:</strong> ${car.transmission || 'N/A'}</p>
              <p><strong>Features:</strong> ${car.features ? car.features.split(',').slice(0, 2).join(', ') : 'N/A'}</p>
              <p class="special-price col-span-2"><strong>Price:</strong> KSh ${parseInt(car.price).toLocaleString()}</p>
            </div>
            <a href="#" class="mt-4 block text-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">View Details</a>
          `;
          
          carCard.appendChild(detailsDiv);
          
          // Add to the container
          carListingsContainer.appendChild(carCard);
        });
      }

      // Function to change carousel image
      function changeCarouselImage(carId, newIndex) {
        // Get all images for this car
        const carousel = document.querySelector(`.carousel-container[data-car-id="${carId}"]`);
        if (!carousel) return;
        
        const images = carousel.querySelectorAll('.carousel-image');
        const dots = carousel.querySelectorAll('.carousel-dot');
        
        // Hide all images and deactivate all dots
        images.forEach(img => img.classList.remove('active'));
        dots.forEach(dot => dot.classList.remove('active'));
        
        // Show the selected image and activate the corresponding dot
        images[newIndex].classList.add('active');
        dots[newIndex].classList.add('active');
      }
      
      // Function to navigate through carousel images
      function navigateCarousel(carId, direction, totalImages) {
        // Get currently active image
        const carousel = document.querySelector(`.carousel-container[data-car-id="${carId}"]`);
        if (!carousel) return;
        
        const activeImage = carousel.querySelector('.carousel-image.active');
        const currentIndex = parseInt(activeImage.dataset.index);
        
        // Calculate new index with wrapping
        let newIndex = (currentIndex + direction + totalImages) % totalImages;
        
        // Change to the new image
        changeCarouselImage(carId, newIndex);
      }
      
      // Your existing code for loading cars...

    } catch (error) {
      console.error('Error fetching cars:', error);
      carListingsContainer.innerHTML = `
        <div class="col-span-3 text-center py-8">
          <p class="text-red-500 font-bold text-lg">Error loading cars.</p>
          <p class="text-gray-700">Please try again later.</p>
        </div>
      `;
    }
  });
</script>